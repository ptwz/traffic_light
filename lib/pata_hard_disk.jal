-- Title: Hard disk library for communicating with parallel ata hard drives
--        with a 40 pin ide connector.
-- Author: Matthew Schinkel - borntechi.com, copyright (c) 2009, all rights reserved.
-- Adapted-by:
-- Compiler: >=2.4k
-- Revision: $Revision: 1.1 $
--
-- This file is part of jallib (http://jallib.googlecode.com)
-- Released under the ZLIB license (http://www.opensource.org/licenses/zlib-license.html)
--
-- Description: this library provides functions for pata/ide hard disk drives.
--
-- Sources:
-- "connecting ide drives by tilmann reh" - http://www.gaby.de/gide/IDE-TCJ.txt
-- IDE hardware reference & information document by alex t. ivopol
-- ATA Attachement with Packet Interface 6 - d1410r3-ATA-ATAPI-6.pdf
--
-- Notes: - If you are not using Alternate Status, Digital Output or Drive Address registers
--          pins cs1 & cs0 can be saved by connecting these ide pins to cs0-high, cs1-low
--          at ide connector. normal operation does not require these pins. Set
--          "CONST BYTE PATA_HD_USE_CS0_CS1_PINS = TRUE" if you will be using
--          these registers
--        - You MUST write full sectors of 512 bytes.
--        - this lib does not do error checking
--
-- Pin-outs - PATA IDE 40 pin connector
-- Power connector - black ground, red +5v, yellow +12v
--                 - 2.5" laptop drives do not need 12v
-- 2,19,22,24,26,30,40 - connect direct to ground
-- 1 - /reset, connect to switch (high 5v for normal operation, low resets drive)
-- 28 - ALE, connect to -> 1k resistor -> 5v
-- 39 - ACT, connect to -> LED -> 1k resistor -> 5v
-- 21,27,20,29,31,32,34, leave not connected
-- 3,5,7,9,11,13,15,17 - D0-D7, connect direct to pata_hd_data_low pins
-- 18,16,14,12,10,8,6,4 - D8-D15, connect direct to pata_hd_data_high pins
-- 23 - /IOW, connect direct to iowr         -- see constant PATA_HD_NO_INVERTER
-- 25 - /IOR, connect direct to pata_hd_iord -- see constant PATA_HD_NO_INVERTER
-- 38 - /cs0, connect direct to pata_hd_cs0 (or gnd) -- see constant PATA_HD_NO_INVERTER & PATA_HD_USE_CS0_CS1_PINS
-- 37 - /cs1, connect direct to pata_hd_cs1 (or 5v) -- see constant PATA_HD_NO_INVERTER & PATA_HD_USE_CS0_CS1_PINS
-- 36 - A2, connect direct to pata_hd_a2
-- 33 - A1, connect direct to pata_hd_a1
-- 35 - A0, connect direct to pata_hd_a0
-- Watch for open drain pins on your pic, use pull-up resistors.
--

-- readable/writeable registers
const PATA_HD_DATA_REG = 8        -- data register
const PATA_HD_SEC_COUNT_REG = 10  -- sector count
const PATA_HD_SEC_NUM_REG = 11    -- sector number
const PATA_HD_CYL_LOW_REG = 12    -- cylinder low
const PATA_HD_CYL_HIGH_REG = 13   -- cylinder high
const PATA_HD_SDH_REG = 14        -- sector/drive/head register

-- readable registers
const PATA_HD_ERROR_REG = 9       -- error register
const PATA_HD_STATUS_REG = 15     -- status register  (creates interupt)
const PATA_HD_ALT_STATUS_REG = 16 -- alternate status (no interupt)
const PATA_HD_ADDRESS_REG = 17    -- drive address

-- writeable registers
const PATA_HD_PRECOMP_REG = 9     -- write precomp reg
const PATA_HD_COMMAND_REG = 15    -- command register
const PATA_HD_DODC_REG = 16       -- digital output / device control

-- common commands for command register:
const PATA_HD_RECALIBRATE = 0x10     -- sends drive heads to cyl 0, SC, SN, and SDH are not changed
const PATA_HD_READ_SECTORS = 0x20     -- reads data from sector(s)
const PATA_HD_WRITE_SECTORS = 0x30    -- write data to sector(s)
const PATA_HD_IDENTIFY_DRIVE = 0xEC  -- read drive info such as make/modem/sn/drive size
const PATA_HD_SPIN_DOWN = 0xE0       -- turn off the drive's motor
const PATA_HD_SPIN_UP = 0xE1         -- turn on the drive's motor

-- other constants
-- used for pata_hd_data_request()
const bit PATA_HD_WAIT_READ = 0  -- wait for sector buffer to fill it's contents with data from disk platters
const bit PATA_HD_WAIT_WRITE = 1 -- wait for sector buffer to empty it's contents to disk platters
const bit PATA_HD_READ = 0  -- wait for sector buffer to fill it's contents with data from disk platters
const bit PATA_HD_WRITE = 1 -- wait for sector buffer to empty it's contents to disk platters

const PATA_HARD_DISK = 0            -- data media constants for fat32 lib
const SD_CARD = 1
const DATA_MEDIA = PATA_HARD_DISK

-- other vars
var byte pata_hd_word_count = 0    -- counts words read from current sector, must be a byte
var byte pata_hd_sector_count = 0  -- counds sectors read, must be a byte.
var dword pata_hd_sector_select = 0
;var bit pata_hd_48_bit_lba_support = false  -- currently this lib does not support drives > 137,438,952,960 bytes (28 bit addressing)
;                                            -- "IDENTIFY DEVICE bit 10 word 83 indicates support for 48-bit addressing" - in ata8 pdf
var bit pata_hd_byte_location = 0
var bit pata_hd_last_operation

-- from "connecting ide drives by tilmann reh" - http://www.gaby.de/gide/ide-tcj.txt
-- List of commands and required parameters:
-- -----------------------------------------------------------------------------
-- command             type  7 6 5 4 3 2 1 0    hex       parameters required
-- -----------------------------------------------------------------------------
-- recalibrate          *    0 0 0 1  (rate)    10-1F     d
-- read sector          *    0 0 1 0 0 m l t    20-27     sc,sn,c,d,h
-- write sector         *    0 0 1 1 0 m l t    30-37     sc,sn,c,d,h
-- scan id / verify     *    0 1 0 0 0 0 0 t    40,41     d,(sc,sn,c,h)
-- write format         *    0 1 0 1 0 0 0 0    50        c,d,h,(sc,sn)
-- seek                 *    0 1 1 1  (rate)    70-7F     c,d,(h)
-- exec diagnostics          1 0 0 1 0 0 0 0    90        d
-- set drive parameters      1 0 0 1 0 0 0 1    91        sc,(c),d,h
-- read multiple        +    1 1 0 0 0 1 0 0    C4        sc,sn,c,d,h
-- write multiple       +    1 1 0 0 0 1 0 1    C5        sc,sn,c,d,h
-- set multiple         +    1 1 0 0 0 1 1 0    C6        sc,d
-- power commands       +    1 1 1 0 0 x x x    E0-E6     sc,d
-- read sector buffer        1 1 1 0 0 1 0 0    E4        d
-- write sector buffer       1 1 1 0 1 0 0 0    E8        d
-- identify drive            1 1 1 0 1 1 0 0    EC        d
-- cache on/off         +    1 1 1 0 1 1 1 1    EF        d,wp
-- power save           +    1 1 1 1 1 x x x    F8-FD     ?

-- ------------------------------------------------
-- register                           abbr.
-- ------------------------------------------------
-- data register                      d
-- error reg. / write precomp. reg.   e / wp
-- sector count                       sc
-- sector number                      sn
-- cylinder low                       c
-- cylinder high                      c
-- sdh (sector size, drive, head)     d,h
-- status reg. / command reg.

-- ----------------------------------------------------------------------------
-- 100ns delay procedure
-- ----------------------------------------------------------------------------
procedure pata_hd_delay_100ns() is
   pragma inline
   if target_clock > 16_000_000 then
      asm nop
   elsif target_clock > 32_000_000 then
      assembler
               local next1
               goto next1  -- Only one instruction that takes
        next1:             -- two instruction cycles ("double-nop")
      end assembler
   elsif target_clock > 50_000_000 then
      assembler
               local next1
               goto next1
        next1: nop
      end assembler
   elsif target_clock > 64_000_000 then
      assembler
               local next1, next2
               goto next1
        next1: goto next2
        next2:
      end assembler
   end if
 end procedure

-- ----------------------------------------------------------------------------
-- Set register select pins to selected register, for internal use only.
-- ----------------------------------------------------------------------------
procedure pata_hd_select_register(byte in register) is	
  -- set register select pins one at a time
  var bit bit0 at register : 0
  var bit bit1 at register : 1
  var bit bit2 at register : 2
  var bit bit3 at register : 3
  var bit bit4 at register : 4

  -- setup data bits
  pata_hd_a0 = bit0
  pata_hd_a1 = bit1
  pata_hd_a2 = bit2
  if PATA_HD_USE_CS0_CS1_PINS == TRUE then
    pata_hd_cs0 = bit3 ^ PATA_HD_NO_INVERTER
    pata_hd_cs1 = bit4 ^ PATA_HD_NO_INVERTER
  end if
end procedure

-- ----------------------------------------------------------------------------
-- Wait for drive to be ready for a data transfer.
-- Sets data pins as inputs or outputs for next read or write.
-- ----------------------------------------------------------------------------
procedure pata_hd_data_request(bit in read_write) is begin
  var bit s
  var bit drq at pata_hd_data_low : 3           -- set drq pin to check
  s = 0
	
  -- set data pins as inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input

  pata_hd_select_register (PATA_HD_STATUS_REG)  -- select status register	

  -- wait for drq in status register to be high.
  -- may get stuck in loop if drq never goes high
  -- you can modify to check for errors or have a time-out
  while s == 0 loop
    pata_hd_iord = high ^ PATA_HD_NO_INVERTER   -- start read pulse
    if drq == high then
      s = 1                                     -- exit loop
    end if
    pata_hd_iord = low ^ PATA_HD_NO_INVERTER    -- end read pulse
  end loop

  -- after drive is ready for data transfer, go to the data register
  pata_hd_select_register (PATA_HD_DATA_REG)

  if read_write == PATA_HD_WAIT_READ then      -- if we are waiting to read data in
    -- do nothing since data pins are already inputs
  else                                         -- if we are waiting to write data out
    -- set data ports to outputs
    pata_hd_data_low_direction = all_output
    pata_hd_data_high_direction = all_output
  end if
end procedure

-- ----------------------------------------------------------------------------
-- Registers may not be accessed unless bsy bit is
-- low due to internal operations.
-- ----------------------------------------------------------------------------
procedure pata_hd_busy() is begin
  var bit s
  s = 1
  var bit bsy at pata_hd_data_low : 7           -- set bsy pin to check
	
  -- set data pins as inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input

  pata_hd_select_register (PATA_HD_STATUS_REG)  -- select status register
	
  -- wait for bsy in status register to be high
  -- may get stuck in loop if bsy never goes low
  -- you can modify to check for errors or have a time-out
  while s == 1 loop
    pata_hd_iord = high ^ PATA_HD_NO_INVERTER   -- start read pulse
    if bsy == low then
      s = 0                                     -- end loop
    end if
    pata_hd_iord = low ^ PATA_HD_NO_INVERTER    -- end read pulse
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Wait for drive to be up to speed and ready for a command.
-- ----------------------------------------------------------------------------
procedure pata_hd_drive_ready() is begin
  var bit s
  s = 1
  var bit rdy at pata_hd_data_low : 6           -- set rdy pin to check
	
  -- set data pins as inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input
	
  pata_hd_select_register (PATA_HD_STATUS_REG)  -- select status register	
	
  -- wait for rdy in status register to be high
  -- may get stuck in loop if rdy never goes high
  -- you can modify to check for errors or have a time-out
  while s == 1 loop
    pata_hd_iord = high ^ PATA_HD_NO_INVERTER   -- start read pulse
    if rdy == high then
      s = 0                                     -- end loop
    end if
    pata_hd_iord = low ^ PATA_HD_NO_INVERTER    -- end read pulse
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Select a register and give it a command or data.
-- ----------------------------------------------------------------------------
procedure pata_hd_register_write(byte in register, byte in low_byte) is begin
  var byte high_byte = 0

  -- registers may not be accessed unless drive is not busy
  pata_hd_busy()

  if register == PATA_HD_COMMAND_REG then
    -- make sure the drive is up to speed and ready for a command
    pata_hd_drive_ready()
  end if

  pata_hd_select_register (register)     -- select register

  -- set data ports to outputs
  pata_hd_data_low_direction = all_output
  pata_hd_data_high_direction = all_output	
	
  -- send the data trough the ide interface
  pata_hd_data_low = low_byte                 -- set low data byte
  pata_hd_data_high = high_byte               -- set high data byte
  pata_hd_iowr = high ^ PATA_HD_NO_INVERTER   -- send write pulse
  pata_hd_iowr = low ^ PATA_HD_NO_INVERTER				
end procedure

-- ----------------------------------------------------------------------------
-- Select a register and get data from it.
-- ----------------------------------------------------------------------------
procedure pata_hd_register_read(byte in register, byte out low_byte) is begin
  var byte high_byte

  -- registers may not be accessed unless drive is not busy
  pata_hd_busy()

  pata_hd_select_register (register)     -- select register

  -- set data ports to inputs
  pata_hd_data_low_direction = all_input
  pata_hd_data_high_direction = all_input

  -- get the data trough the ide interface
  pata_hd_iord = high ^ PATA_HD_NO_INVERTER      -- start read pulse
  pata_hd_delay_100ns()                          -- tiny delay
  low_byte = pata_hd_data_low                    -- get low data byte
  high_byte  = pata_hd_data_high                 -- get high data byte
  pata_hd_iord = low ^ PATA_HD_NO_INVERTER       -- end read pulse
end procedure

-- ----------------------------------------------------------------------------
-- Go to a specific sector, select lba/chs mode and master/slave drive
-- Max sector number is 0x0F_FF_FF_FF or the number of sectors the drive has.
-- Max drive size is 0x0F_FF_FF_FF * 512 = 137.439 GB
-- Sector count selects number of sectors that will be read
-- Sector count value of 0 means 256 sectors will be read
-- ----------------------------------------------------------------------------
procedure pata_hd_set_address(byte in pata_hd_head_addr, byte in cyl_high_addr, byte in cyl_low_addr, byte in sec_num_addr, byte in sec_count) is
  -- select lba or chs mode
  var volatile byte  pata_hd_sdh_val    =     0b_1110_0000
  var volatile bit   pata_hd_lba              at pata_hd_sdh_val : 6
  var volatile bit   pata_hd_slave            at pata_hd_sdh_val : 4

  -- select drive options
  pata_hd_lba = true                             -- 1 = lba mode, 0 = chs mode (not tested)
  pata_hd_slave = false                          -- 0 = master,   1 = slave    (not tested)
	
  pata_hd_register_write (PATA_HD_SEC_COUNT_REG,sec_count)     -- set sec count register, sectors to read/write	
  pata_hd_register_write (PATA_HD_SEC_NUM_REG,sec_num_addr)    -- set sec number register address	
  pata_hd_register_write (PATA_HD_CYL_LOW_REG,cyl_low_addr)    -- set cyl low register address	
  pata_hd_register_write (PATA_HD_CYL_HIGH_REG,cyl_high_addr)  -- set cyl high register address		
  -- set sector/drive/head register, head number
  -- pata_hd_head_val address can be 0 to 15
  pata_hd_register_write (PATA_HD_SDH_REG,pata_hd_sdh_val + pata_hd_head_addr)					
end procedure

-- ----------------------------------------------------------------------------
-- Go to a specific sector number (lba mode only)
-- Max sector number is 268435455 or the number of sectors the drive has.
-- Max drive size is 268435455 * 512 = 137.439 GB
-- Sector count selects number of sectors that will be read
-- Sector count value of 0 means 256 sectors will be read
-- ----------------------------------------------------------------------------
procedure pata_hd_go_to_sector(dword in sector, byte in sec_count) is
  var byte sec_num_addr,cyl_low_addr,cyl_high_addr,pata_hd_head_addr

  -- change sector number into bytes
  var byte  dval[4] at sector
  sec_num_addr = dval[0]
  cyl_low_addr = dval[1]
  cyl_high_addr = dval[2]
  pata_hd_head_addr = dval[3]

  -- go to the address
  pata_hd_set_address (pata_hd_head_addr,cyl_high_addr,cyl_low_addr,sec_num_addr,sec_count)
end procedure

-- ----------------------------------------------------------------------------
-- Get drive ready for reading at specified address
-- ----------------------------------------------------------------------------
procedure pata_hd_start_read(dword in address) is
  pata_hd_sector_select = address   -- set the users selected sector
  pata_hd_word_count = 0            -- reset number of words read from sector
  pata_hd_sector_count = 0          -- reset number of sectors read
  pata_hd_byte_location = 0
end procedure

-- ----------------------------------------------------------------------------
-- Read two bytes from disk.
-- ----------------------------------------------------------------------------
procedure pata_hd_read_data(byte out low_byte, byte out high_byte) is
  if (pata_hd_word_count == 0) & (pata_hd_sector_count) == 0 then        -- if we are at beginning of read
    pata_hd_go_to_sector(pata_hd_sector_select,0)                        -- go to the selected sector
    pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_READ_SECTORS)      -- send the read command to the command register	
    pata_hd_data_request(PATA_HD_WAIT_READ)                              -- wait till the drive has data for you
  elsif pata_hd_word_count == 0 then                                     -- if we are at beginning of a sector
    pata_hd_data_request(PATA_HD_WAIT_READ)                              -- wait for data to be ready for read
  end if
  	
  if pata_hd_word_count == 255 then                                      -- if we are at end of current sector
    pata_hd_sector_select = pata_hd_sector_select + 1                    -- increment the selected sector
    pata_hd_sector_count = pata_hd_sector_count + 1                      -- increase sector count
  end if
  	
  pata_hd_word_count = pata_hd_word_count + 1   -- increment words read from current sector
	
  -- get the data trough the ide interface
  pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
  pata_hd_delay_100ns()
  low_byte = pata_hd_data_low                -- get low data byte
  high_byte  = pata_hd_data_high             -- get high data byte
  pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse 	
end procedure

;-- ----------------------------------------------------------------------------
;-- Read one byte
;-- ----------------------------------------------------------------------------
;procedure pata_hd_read_data_byte(byte out data_byte) is
;  var byte low_byte
;  if pata_hd_byte_location == 0 then
;     pata_hd_read_data(low_byte,pata_hd_high_byte2)
;     data_byte = low_byte
;  else
;     data_byte = pata_hd_high_byte2
;  end if	
;  pata_hd_byte_location = pata_hd_byte_location + 1
;end procedure


-- ----------------------------------------------------------------------------
-- Read one byte (pseudo var)
-- ----------------------------------------------------------------------------
var byte pata_hd_high_byte2
function pata_hd_data_byte'get() return byte is
  var byte low_byte
  if pata_hd_byte_location == 0 then
     pata_hd_read_data(low_byte,pata_hd_high_byte2)
     pata_hd_byte_location = 1
     return low_byte
  else
     pata_hd_byte_location = 0
     return pata_hd_high_byte2
  end if	
end function

-- ----------------------------------------------------------------------------
-- Send a number of read pulses to data register without getting any data.
-- Goes forward 2 bytes per amount
-- Used to get to the end of a sector or to get to a certain
-- location in a sector.
-- Increment pata_hd_word_count
-- ----------------------------------------------------------------------------
procedure pata_hd_read_pulse(dword in amount) is
  var byte x,y
  for amount loop
    pata_hd_read_data (x,y)                         		
  end loop
  pata_hd_byte_location = 0
end procedure

-- ----------------------------------------------------------------------------
-- goes to next byte instead of word like pata_hd_read_pulse
-- ----------------------------------------------------------------------------
procedure pata_hd_read_pulse_byte(dword in z) is
  var byte low_byte
  for z loop
     if pata_hd_byte_location == 0 then
        pata_hd_read_data(low_byte,pata_hd_high_byte2)
        pata_hd_byte_location = 1
     else
        pata_hd_byte_location = 0
     end if	                 		
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Tell drive you are done reading
-- ----------------------------------------------------------------------------
procedure pata_hd_stop_read() is
  pragma inline
  ;-- just do something to get the hd led to turn off
  pata_hd_register_write(PATA_HD_COMMAND_REG, 0xE5) -- read power mode
  ;pata_hd_register_write(PATA_HD_COMMAND_REG, 0xE1) -- set media idle
end procedure

-- ----------------------------------------------------------------------------
-- Set hard disk to idle state
-- ----------------------------------------------------------------------------
procedure pata_hd_set_idle() is
  pragma inline
  pata_hd_register_write(PATA_HD_COMMAND_REG, 0xE1) -- set media idle
end procedure

-- ----------------------------------------------------------------------------
-- Get drive ready for writing at specified address
-- ----------------------------------------------------------------------------
alias pata_hd_start_write is pata_hd_start_read
;  procedure pata_hd_start_write(dword in address) is
;     pata_hd_sector_select = address
;     pata_hd_word_count = 0              -- reset number of words written to sector
;     pata_hd_sector_count = 0            -- reset number of sectors written
;     pata_hd_byte_location = 0
;  end procedure

-- ----------------------------------------------------------------------------
-- Write two bytes to disk
-- Data will not be written unless 256 writes are sent.
-- ----------------------------------------------------------------------------
procedure pata_hd_write_data(byte in low_byte, byte in high_byte) is
  if pata_hd_word_count == 0 then                                     -- if we are at beginning of write
    pata_hd_go_to_sector (pata_hd_sector_select,1)                    -- go to the correct sector, set to write 1 sector
    pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_WRITE_SECTORS) -- send the write command to the command register
    pata_hd_data_request(PATA_HD_WAIT_WRITE)                          -- wait till data is ready to be read
  end if
  	
  if pata_hd_word_count == 255 then                                   -- if we are at the end of a sector
     pata_hd_sector_count = pata_hd_sector_count + 1                  -- increment sectors written
     pata_hd_sector_select = pata_hd_sector_select + 1                -- increment the selected sector
  end if
  
  pata_hd_word_count = pata_hd_word_count + 1    -- increment words written to disk
	
  -- send the data trough the ide interface
  pata_hd_data_low = low_byte                    -- set low data byte
  pata_hd_data_high = high_byte                  -- set high data byte
  pata_hd_iowr = high ^ PATA_HD_NO_INVERTER      -- send write pulse
  pata_hd_iowr = low ^ PATA_HD_NO_INVERTER 	  	
end procedure

-- ----------------------------------------------------------------------------
-- Write one byte to disk
-- Data will not be written unless 256 writes are sent.
-- ----------------------------------------------------------------------------
;procedure pata_hd_write_data_byte(byte in data_byte) is
;  if pata_hd_byte_location == 0 then
;     pata_hd_high_byte = data_byte
;       pata_hd_byte_location = 1
;  else
;     pata_hd_write_data(pata_hd_high_byte,data_byte)
;       pata_hd_byte_location = 0
;  end if	
;end procedure

-- ----------------------------------------------------------------------------
-- Write one byte to disk pseudo var
-- ----------------------------------------------------------------------------
var byte pata_hd_high_byte
procedure pata_hd_data_byte'put(byte in data_byte) is
  if pata_hd_byte_location == 0 then
     pata_hd_high_byte = data_byte
       pata_hd_byte_location = 1
  else
     pata_hd_write_data(pata_hd_high_byte,data_byte)
       pata_hd_byte_location = 0
  end if	
end procedure

-- ----------------------------------------------------------------------------
-- Send a number of write pulses to data register sending 0's as data.
-- Used to get to the end of a sector or to get to a certain
-- location in a sector.
-- Increment pata_hd_word_count
-- ----------------------------------------------------------------------------
procedure pata_hd_write_pulse( byte in z ) is begin
  for z loop -- send write pulse z number of times
    pata_hd_write_data (0,0)
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- goes to next byte instead of word like pata_hd_write_pulse
-- ----------------------------------------------------------------------------
procedure pata_hd_write_pulse_byte(dword in z) is
  for z loop
    if pata_hd_byte_location == 1 then
       pata_hd_write_data (pata_hd_high_byte,0)
       pata_hd_byte_location = 0
    else
       pata_hd_write_data (0,0)
       pata_hd_byte_location = 1
    end if                     		
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Finnish writing the current sector with input byte.
-- ----------------------------------------------------------------------------
procedure pata_hd_write_to_sector_end(byte in input_byte) is
  var byte x
  x = 0 - pata_hd_word_count -- calculate how many words are left to write to current sector
  for x loop                 -- loop till end of sector
    pata_hd_write_data(input_byte, input_byte) -- write 2 bytes
  end loop
end procedure

-- ----------------------------------------------------------------------------
-- Tell drive you are done writing
-- ----------------------------------------------------------------------------
procedure pata_hd_stop_write() is
   if pata_hd_byte_location == 1 then
      pata_hd_data_byte = 0
   end if
   pata_hd_write_to_sector_end(0)
   pata_hd_stop_read() -- same as stop read
end procedure

---------------------------------------------------------------------------
-- define the sector buffer. Can be read as pata_hd_sector_buffer[0-511]
---------------------------------------------------------------------------
var byte pata_hd_sector_buffer_low[256] -- 256 low bytes
var byte pata_hd_sector_buffer_high[256] -- 256 high bytes
function pata_hd_sector_buffer'get(word in address) return byte is
   pragma inline
   if bit(address) == 0 then
      return pata_hd_sector_buffer_low[address / 2]
   else
      return pata_hd_sector_buffer_high[(address / 2)]
   end if
end function
--
procedure pata_hd_sector_buffer'put(word in address, byte in data) is
   pragma inline
   if bit(address) == 0 then
      pata_hd_sector_buffer_low[address / 2] = data
   else
      pata_hd_sector_buffer_high[(address / 2)] = data
   end if
end procedure

---------------------------------------------------------------------------
-- For faster reading in pata_hd_read_sector procedures
---------------------------------------------------------------------------
procedure _pata_read_512() is
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	0	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	0	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	1	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	1	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	2	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	2	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	3	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	3	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	4	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	4	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	5	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	5	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	6	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	6	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	7	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	7	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	8	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	8	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	9	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	9	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	10	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	10	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	11	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	11	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	12	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	12	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	13	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	13	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	14	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	14	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	15	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	15	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	16	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	16	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	17	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	17	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	18	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	18	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	19	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	19	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	20	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	20	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	21	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	21	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	22	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	22	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	23	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	23	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	24	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	24	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	25	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	25	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	26	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	26	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	27	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	27	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	28	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	28	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	29	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	29	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	30	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	30	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	31	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	31	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	32	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	32	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	33	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	33	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	34	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	34	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	35	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	35	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	36	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	36	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	37	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	37	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	38	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	38	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	39	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	39	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	40	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	40	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	41	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	41	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	42	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	42	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	43	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	43	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	44	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	44	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	45	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	45	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	46	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	46	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	47	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	47	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	48	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	48	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	49	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	49	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	50	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	50	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	51	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	51	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	52	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	52	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	53	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	53	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	54	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	54	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	55	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	55	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	56	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	56	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	57	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	57	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	58	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	58	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	59	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	59	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	60	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	60	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	61	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	61	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	62	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	62	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	63	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	63	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	64	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	64	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	65	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	65	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	66	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	66	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	67	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	67	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	68	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	68	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	69	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	69	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	70	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	70	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	71	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	71	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	72	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	72	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	73	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	73	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	74	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	74	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	75	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	75	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	76	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	76	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	77	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	77	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	78	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	78	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	79	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	79	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	80	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	80	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	81	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	81	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	82	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	82	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	83	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	83	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	84	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	84	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	85	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	85	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	86	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	86	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	87	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	87	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	88	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	88	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	89	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	89	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	90	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	90	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	91	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	91	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	92	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	92	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	93	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	93	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	94	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	94	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	95	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	95	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	96	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	96	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	97	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	97	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	98	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	98	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	99	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	99	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	100	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	100	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	101	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	101	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	102	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	102	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	103	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	103	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	104	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	104	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	105	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	105	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	106	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	106	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	107	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	107	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	108	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	108	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	109	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	109	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	110	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	110	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	111	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	111	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	112	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	112	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	113	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	113	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	114	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	114	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	115	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	115	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	116	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	116	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	117	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	117	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	118	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	118	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	119	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	119	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	120	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	120	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	121	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	121	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	122	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	122	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	123	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	123	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	124	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	124	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	125	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	125	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	126	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	126	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	127	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	127	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	128	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	128	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	129	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	129	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	130	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	130	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	131	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	131	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	132	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	132	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	133	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	133	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	134	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	134	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	135	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	135	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	136	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	136	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	137	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	137	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	138	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	138	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	139	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	139	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	140	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	140	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	141	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	141	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	142	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	142	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	143	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	143	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	144	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	144	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	145	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	145	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	146	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	146	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	147	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	147	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	148	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	148	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	149	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	149	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	150	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	150	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	151	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	151	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	152	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	152	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	153	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	153	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	154	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	154	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	155	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	155	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	156	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	156	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	157	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	157	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	158	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	158	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	159	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	159	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	160	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	160	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	161	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	161	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	162	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	162	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	163	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	163	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	164	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	164	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	165	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	165	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	166	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	166	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	167	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	167	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	168	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	168	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	169	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	169	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	170	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	170	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	171	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	171	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	172	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	172	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	173	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	173	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	174	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	174	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	175	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	175	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	176	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	176	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	177	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	177	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	178	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	178	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	179	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	179	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	180	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	180	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	181	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	181	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	182	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	182	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	183	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	183	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	184	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	184	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	185	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	185	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	186	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	186	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	187	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	187	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	188	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	188	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	189	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	189	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	190	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	190	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	191	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	191	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	192	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	192	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	193	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	193	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	194	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	194	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	195	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	195	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	196	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	196	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	197	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	197	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	198	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	198	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	199	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	199	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	200	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	200	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	201	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	201	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	202	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	202	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	203	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	203	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	204	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	204	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	205	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	205	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	206	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	206	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	207	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	207	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	208	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	208	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	209	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	209	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	210	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	210	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	211	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	211	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	212	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	212	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	213	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	213	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	214	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	214	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	215	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	215	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	216	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	216	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	217	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	217	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	218	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	218	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	219	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	219	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	220	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	220	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	221	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	221	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	222	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	222	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	223	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	223	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	224	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	224	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	225	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	225	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	226	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	226	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	227	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	227	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	228	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	228	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	229	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	229	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	230	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	230	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	231	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	231	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	232	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	232	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	233	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	233	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	234	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	234	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	235	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	235	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	236	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	236	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	237	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	237	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	238	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	238	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	239	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	239	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	240	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	240	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	241	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	241	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	242	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	242	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	243	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	243	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	244	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	244	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	245	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	245	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	246	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	246	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	247	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	247	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	248	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	248	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	249	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	249	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	250	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	250	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	251	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	251	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	252	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	252	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	253	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	253	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	254	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	254	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
   pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
   pata_hd_delay_100ns()
   pata_hd_sector_buffer_low[	255	] = pata_hd_data_low  -- get low data				
   pata_hd_sector_buffer_high[	255	] = pata_hd_data_high -- get high data				
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read
end procedure

---------------------------------------------------------------------------
-- read one entire sector
---------------------------------------------------------------------------
procedure pata_hd_read_sector() is
   var word count1
   pata_hd_word_count = 0

   if pata_hd_sector_count == 0 then
     pata_hd_go_to_sector(pata_hd_sector_select,0)
     pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_READ_SECTORS)
   end if

   pata_hd_data_request(PATA_HD_WAIT_READ)

   -- get sector data
   if defined(PATA_HD_READ_EXTRA_SPEED) == TRUE then
      if PATA_HD_READ_EXTRA_SPEED == TRUE then
         _pata_read_512()
      else
         for 256 using count1 loop
            -- get the data trough the ide interface
            pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
            pata_hd_delay_100ns()
            pata_hd_sector_buffer_low[count1] = pata_hd_data_low  -- get low data
            pata_hd_sector_buffer_high[count1] = pata_hd_data_high -- get high data
            pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
         end loop
      end if
   else
      for 256 using count1 loop
         -- get the data trough the ide interface
         pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
         pata_hd_delay_100ns()
         pata_hd_sector_buffer_low[count1] = pata_hd_data_low  -- get low data
         pata_hd_sector_buffer_high[count1] = pata_hd_data_high -- get high data
         pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
      end loop
   end if

   pata_hd_sector_select = pata_hd_sector_select + 1
   pata_hd_sector_count = pata_hd_sector_count + 1
end procedure

--------------------------------------------------------------------------------
-- read one entire sector at address. no need for start_read/stop_read
--------------------------------------------------------------------------------
var dword pata_hd_last_sector
var byte pata_hd_sector_count2 = 0
var dword pata_hd_prev_address = 0
var dword pata_hd_current_address = 0xFF_FF_FF_FF
procedure pata_hd_read_sector_address(dword in address) is
   if !(address == pata_hd_current_address) then
      pata_hd_start_read(address)
   end if

   var word count1
   pata_hd_word_count = 0

   -- check if we are at the correct sector already
   -- if not, go to the sector and start reading
   if (pata_hd_last_operation == PATA_HD_WRITE) | (pata_hd_sector_count2 == 0) | (!(pata_hd_last_sector + 1 == pata_hd_sector_select)) then       -- if we are at beginning of read
      pata_hd_go_to_sector(pata_hd_sector_select,0)                        -- go to the selected sector
      pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_READ_SECTORS)     -- send the read command to the command register	
      pata_hd_last_operation = PATA_HD_READ                              -- set last operation to read
   end if

   pata_hd_data_request(PATA_HD_WAIT_READ) -- wait for data to be ready for read before each sector

   -- get sector data
   if defined(PATA_HD_READ_EXTRA_SPEED) == TRUE then
      if PATA_HD_READ_EXTRA_SPEED == TRUE then
         _pata_read_512()
      else
         for 256 using count1 loop
            -- get the data trough the ide interface
            pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
            pata_hd_delay_100ns()
            pata_hd_sector_buffer_low[count1] = pata_hd_data_low  -- get low data
            pata_hd_sector_buffer_high[count1] = pata_hd_data_high -- get high data
            pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
         end loop
      end if
   else
      for 256 using count1 loop
         -- get the data trough the ide interface
         pata_hd_iord = high ^ PATA_HD_NO_INVERTER  -- start read pulse
         pata_hd_delay_100ns()
         pata_hd_sector_buffer_low[count1] = pata_hd_data_low  -- get low data
         pata_hd_sector_buffer_high[count1] = pata_hd_data_high -- get high data
         pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- end read pulse
      end loop
   end if

   pata_hd_last_sector = pata_hd_sector_select
   pata_hd_sector_select = pata_hd_sector_select + 1  -- increment the selected sector
   pata_hd_sector_count = pata_hd_sector_count + 1    -- increase sector count
   pata_hd_sector_count2 = pata_hd_sector_count2 + 1    -- increase sector count2

   pata_hd_current_address = address + 1
end procedure


-- ----------------------------------------------------------------------------
-- Write one sector to the disk, requires start write/stop write.
-- ----------------------------------------------------------------------------
procedure pata_hd_write_sector() is
   var word count1
   
   ;if pata_hd_sector_count == 0 then
      pata_hd_go_to_sector (pata_hd_sector_select,1)                    -- go to the correct sector, set sector count to 0
      pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_WRITE_SECTORS)-- send the write command to the command register
   ;end if

   pata_hd_data_request(PATA_HD_WAIT_WRITE)                          -- wait till data is ready to be written
  	
   for 256 using count1 loop
      -- put the data onto the ide interface
      pata_hd_data_low = pata_hd_sector_buffer_low[count1]   -- put low data
      pata_hd_data_high = pata_hd_sector_buffer_high[count1] -- put high data
      pata_hd_delay_100ns()                                  -- delay about 100ns
      pata_hd_iowr = high ^ PATA_HD_NO_INVERTER              -- send write pulse
      pata_hd_delay_100ns()                                  -- delay about 100ns
      pata_hd_iowr = low ^ PATA_HD_NO_INVERTER
   end loop		  	

   pata_hd_sector_select = pata_hd_sector_select + 1
   pata_hd_sector_count = pata_hd_sector_count + 1
   
;  pata_hd_register_write (PATA_HD_SEC_COUNT_REG,0)
end procedure

--------------------------------------------------------------------------------
-- write one entire sector at address. no need for start_read/stop_read
--------------------------------------------------------------------------------
procedure pata_hd_write_sector_address(dword in address) is
   -- work needs to be done so we don't need to do start write/stop write
   -- at every sector.

   ;if !(address == pata_hd_current_address) then
   pata_hd_start_write(address)
   ;end if

   var word count1
   pata_hd_word_count = 0

   ;-- check if we are at the correct sector already
   ;-- if not, go to the sector and start writing
   ;if (pata_hd_last_operation == PATA_HD_READ) | (pata_hd_sector_count2 == 0) |
   ;(!(pata_hd_last_sector + 1 == pata_hd_sector_select)) then          -- if we are at beginning of write
     pata_hd_go_to_sector (pata_hd_sector_select,1)                     -- go to the correct sector, set sector count to 0
     pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_WRITE_SECTORS) -- send the write command to the command register
     pata_hd_last_operation = PATA_HD_WRITE                             -- set last operation to write
   ;end if

   pata_hd_data_request(PATA_HD_WAIT_WRITE)  -- wait for data to be ready for write before each sector

   -- put sector data
   for 256 using count1 loop
      -- put the data onto the ide interface
      pata_hd_data_low = pata_hd_sector_buffer_low[count1]    -- get low data
      pata_hd_data_high = pata_hd_sector_buffer_high[count1]   -- get high data
      pata_hd_delay_100ns()                                  -- delay about 100ns
      pata_hd_iowr = high ^ PATA_HD_NO_INVERTER              -- send write pulse
      pata_hd_delay_100ns()                                  -- delay about 100ns
      pata_hd_iowr = low ^ PATA_HD_NO_INVERTER
   end loop		

   pata_hd_last_sector = pata_hd_sector_select
   pata_hd_sector_select = pata_hd_sector_select + 1  -- increment the selected sector
   ;pata_hd_sector_count = pata_hd_sector_count + 1    -- increase sector count
   pata_hd_sector_count2 = pata_hd_sector_count2 + 1    -- increase sector count2

   pata_hd_current_address = address + 1
end procedure

-- ----------------------------------------------------------------------------
-- print a sector to an output device
-- ----------------------------------------------------------------------------
procedure pata_hd_print_sector(volatile byte out device, dword in address) is
   pata_hd_start_read(address)
   for 512 loop
      device = pata_hd_data_byte
   end loop
   pata_hd_stop_read
end procedure

-- ----------------------------------------------------------------------------
-- print a sector to an output device in ascii hex
-- ----------------------------------------------------------------------------
procedure pata_hd_print_sector_hex(volatile byte out device,word in bytes_per_line,dword in address) is
   pata_hd_start_read(address)
   for 512 / bytes_per_line loop
      print_crlf(device)
      for bytes_per_line loop
         device = " "
         print_byte_hex(device,pata_hd_data_byte)
      end loop
   end loop
   pata_hd_stop_read
end procedure

-- ----------------------------------------------------------------------------
-- initialize startup settings
-- ----------------------------------------------------------------------------
procedure pata_hd_init() is begin
  -- set startup setting for read/read pins
	pata_hd_iowr = low ^ PATA_HD_NO_INVERTER   -- start write pulse pin low
   pata_hd_iord = low ^ PATA_HD_NO_INVERTER   -- start read pulse pin low

   -- recalibrate the drive
   pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_RECALIBRATE)
   pata_hd_busy()

   -- send some read pulses
   pata_hd_start_read(0)
   pata_hd_read_pulse(256)
   pata_hd_stop_read()

   pata_hd_register_write (PATA_HD_COMMAND_REG,PATA_HD_RECALIBRATE) -- recalibrate the drive
   pata_hd_busy()
end procedure

-- ----------------------------------------------------------------------------
-- Get the size of the drive (number of sectors).
-- Multiply by 512 for actual size.
-- ----------------------------------------------------------------------------
function pata_hd_number_of_sectors'get() return dword is
   var dword num_of_sectors
   var byte _num_of_sectors[4] at num_of_sectors

   -- send the identify drive command
   pata_hd_register_write(PATA_HD_COMMAND_REG,PATA_HD_IDENTIFY_DRIVE)

   -- check if drive is ready reading and set data ports as inputs
   -- this MUST be used before reading since we did not use pata_hd_start_read
   pata_hd_data_request(PATA_HD_WAIT_READ)

   -- Read
   for 60 loop
      pata_hd_read_data(_num_of_sectors[0],_num_of_sectors[0])
   end loop

   pata_hd_read_data(_num_of_sectors[0],_num_of_sectors[1])
   pata_hd_read_data(_num_of_sectors[2],_num_of_sectors[3])

   return num_of_sectors
end function
